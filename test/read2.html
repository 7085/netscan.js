<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>test</title>
		<!-- <script src="adapter.js"></script> -->
		<style>
			ul {
				display: inline-block;
				vertical-align: top;
			}

			li:first-child {
				list-style: none;
				font-weight: bold;
			}
		</style>
	</head>
	<body>
	<script src="../src/netscan.js"></script>
	<script>
		function list(r) {
			var upList = document.getElementById("up");
			var downList = document.getElementById("down");
			

			r.sort((a,b) => {return a.time - b.time});
			
			for(var i = 0; i < r.length; i++){
				if(r[i].status === "up"){
					upList.insertAdjacentHTML("beforeend", "<li>"+ r[i].ip +" <span style=\"color:#ccc\">"+ r[i].time.toFixed(2) +"</span></li>");
				}
				else {
					downList.insertAdjacentHTML("beforeend", "<li>"+ r[i].ip +" <span style=\"color:#ccc\">"+ r[i].time.toFixed(2) +"</span></li>");
				}
			}
			
		}

		//NetScan.Scan.getIps(ips => {console.log(NetScan.Timer.durationInSec("getIps"), JSON.stringify(ips))});
		
/*
		//NetScan.Scan.getHostsWS("128.130.240.0-255", (r) => console.log(r));
		//NetScan.Scan.getHostsWS("192.168.2.0-25", (r) => {
		NetScan.Scan.getHostsWS("10.0.0.0-255", (r) => {
			var upList = document.getElementById("up");
			var downList = document.getElementById("down");

			r.sort((a,b) => {return a.time - b.time});
			
			for(var i = 0; i < r.length; i++){
				if(r[i].status === "up"){
					upList.insertAdjacentHTML("beforeend", "<li>"+ r[i].ip +" <span style=\"color:#ccc\">"+ r[i].time.toFixed(2) +"</span></li>");
				}
				else {
					downList.insertAdjacentHTML("beforeend", "<li>"+ r[i].ip +" <span style=\"color:#ccc\">"+ r[i].time.toFixed(2) +"</span></li>");
				}
			}
		});



		NetScan.Timer.start("t1");
		NetScan.Scan.getHostsLocalNetwork(r => {
			var timeHTML = document.getElementById("time");
			NetScan.Timer.stop("t1"); // XXX y u not work?!?
			timeHTML.textContent = NetScan.Timer.duration("t1");
			list(r);
		});

*/

		//NetScan.Scan.getHostsXHR("192.168.2.0-255", list);


	</script>

		<h1>html stub for testing</h1>
		<h3 id="time">processing...</h3>
		<ul id="up">
			<li>UP</li>
		</ul>
		<ul id="down">
			<li>DOWN</li>
		</ul>
		
<!--
<svg width="200" height="200" id="svg1" style="background-image: -moz-element(#ifr); background-color: #d4d4d4;">

   <circle cx="50" cy="50" r="50" style="fill: #999;"></circle>
</svg>

<svg width="200" height="200">
  <defs>
    <filter id="ShiftBGAndBlur" 
            filterUnits="userSpaceOnUse" x="0" y="0" width="1200" height="400">
      <desc>
        This filter discards the SourceGraphic, if any, and just produces
        a result consisting of the BackgroundImage shifted down 125 units
        and then blurred.
      </desc>
      <feOffset in="BackgroundImage" dx="0" dy="125" />
      <feGaussianBlur stdDeviation="8" />
    </filter>
    <filter id="ShiftBGAndBlur_WithSourceGraphic" 
            filterUnits="userSpaceOnUse" x="0" y="0" width="1200" height="400">
      <desc>
        This filter takes the BackgroundImage, shifts it down 125 units, blurs it,
        and then renders the SourceGraphic on top of the shifted/blurred background.
      </desc>
      <feOffset in="BackgroundImage" dx="0" dy="125" />
      <feGaussianBlur stdDeviation="8" result="blur" />
      <feMerge>
        <feMergeNode in="blur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>
  <g enable-background="new" transform="translate(0,0)">
    <desc>The second adds an empty 'g' element which invokes ShiftBGAndBlur.</desc>
    <rect x="25" y="25" width="100" height="100" fill="red"/>
	<use xlink:href="#svg1"></use>
    <g opacity=".5">
      <circle cx="125" cy="75" r="45" fill="green"/>
      <polygon points="160,25 160,125 240,75" fill="blue"/>
    </g>
    <g filter="url(#ShiftBGAndBlur)"/>
    <rect x="5" y="5" width="260" height="260" fill="none" stroke="blue"/>
	
  </g>
   
</svg>
-->
<style>
.c1 {
	filter:url(#f1);
}

iframe {
	border: none;
}
</style>
<iframe class="c1" id="ifr" src="view-source:http://doesnotexist2384304.com"></iframe>

<svg xmlns="http://www.w3.org/2000/svg" version="1.1">
  <defs>
    <filter id="f1" x="0" y="0"><!-- filterUnits="userSpaceOnUse" width="1200" height="400" -->
<!--
      <feOffset in="BackgroundImage" dx="0" dy="25" />
      <feGaussianBlur stdDeviation="8" result="blur" />
      <feMerge>
        <feMergeNode in="blur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>

<feImage xlink:href="#ttt"  result="gradient"/> -->
		<feGaussianBlur in="BackgroundImage" stdDeviation="1" />
    </filter>
  </defs>
</svg>

<div id="ttt" class="c1" style="width: 500px; height: 200px; background-image: -moz-element(#ifr);">test</div>
<div id="tt" class="c2" style="width: 500px; height: 200px; background-image: -moz-element(#ttt);">test</div>

<canvas id="canvas" style="border:2px solid black;" width="600" height="600">
</canvas>

<svg id="svg1" xmlns="http://www.w3.org/2000/svg" xmlns:html="http://www.w3.org/1999/xhtml">
	<rect width="100" height="100" style="fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)" />
</svg>

<svg id="svg2" xmlns="http://www.w3.org/2000/svg" xmlns:html="http://www.w3.org/1999/xhtml">
<foreignObject width="560" height="349">
    <iframe xmlns="http://www.w3.org/1999/xhtml"
    width="560" height="315" src="data:text/html;charset=utf-8,%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%20style%3D%22background-color%3A%23000%22%3E%3C%2Fbody%3E%3C%2Fhtml%3E" frameborder="0"></iframe>
</foreignObject>
</svg>

<svg id="svg3" xmlns="http://www.w3.org/2000/svg" xmlns:html="http://www.w3.org/1999/xhtml">
  <defs>
    <style type="text/css"><![CDATA[
      text {
        fill: red;
        stroke: blue;
        stroke-width: 3
      }
    ]]></style>

    <pattern id="circles-1" patternUnits="userSpaceOnUse" width="10" height="10">
      <image xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPScjZmZmJyAvPgogIDxjaXJjbGUgY3g9IjEiIGN5PSIxIiByPSIxIiBmaWxsPSIjMDAwIi8+Cjwvc3ZnPg=="
        x="0" y="0" width="10" height="10">
      </image>
    </pattern>
  </defs>
<text x="0" y="15" style="fill:red; background: -moz-element(#foreign); background: url(#svg1);">I love SVG!</text>
<rect style="fill: url(#circles-1) #fff;" x="0" y="0" height="100" width="100"></rect>
<foreignObject id="foreign" width="560" height="349" style="opacity:0.4">
    <iframe xmlns="http://www.w3.org/1999/xhtml" width="560" height="315" src="data:text/html;charset=utf-8,%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%20style%3D%22background-color%3A%23000%22%3E%3C%2Fbody%3E%3C%2Fhtml%3E" frameborder="0"></iframe>
</foreignObject>
</svg>

	<script>
setTimeout(function(){
		// Get well-formed markup
		var html = (new XMLSerializer).serializeToString(document.getElementById("svg3"));
		console.log(html);


var DOMURL = window.URL || window.webkitURL || window;

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');

var img = new Image();
var svg = new Blob([html], {type: 'image/svg+xml;charset=utf-8'});
var url = DOMURL.createObjectURL(svg);
console.log(url);

var dimg = 'data:image/svg+xml;base64,'+ btoa(html);
console.log(dimg);

img.onload = function () {
  ctx.drawImage(img, 0, 0);
  DOMURL.revokeObjectURL(url);
}

img.src = url;
}, 2000);
	</script>
	</body>
</html> 
